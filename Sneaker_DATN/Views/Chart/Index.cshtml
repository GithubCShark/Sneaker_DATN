
@{
    ViewData["Title"] = "Chart";
    Layout = "~/Views/Shared/_LayoutManager.cshtml";
}

<div class="color-dashboard">
    <h2 class="main-title text-center pt-4">CHI TIẾT THỐNG KÊ</h2>
    <div class="col-lg-12 m-auto px-5 pb-4">
        <div class="card shadow-sm">
            <div class="card-body justify-content-around">
                <div class="row col-lg-12">
                    <div class="input-group col-lg-8 col-sm-6">
                        <div class="form-outline d-flex">
                            <div class="ml-3">
                                <select id="ddlYear">
                                    <option value="0">Chọn năm...</option>
                                    <option value="2020">2020</option>
                                    <option value="2021" selected>2021</option>
                                    <option value="2022">2022</option>
                                </select>
                            </div>
                            <button type="button" class="search-btn btn btn-primary">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-12 m-auto px-5 pb-5">
        <div class="users-table table-wrapper">
            <div id="dvChart">
                <canvas id="chartProduct"></canvas>
            </div>
        </div>
        <div class="users-table table-wrapper">
            <div>
                <canvas id="chartPrice"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js" type="text/javascript"></script>*@
    @*<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>*@

    <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js" type="text/javascript"></script>


    <script>
        var ctx1 = document.getElementById('chartPrice');
        var barChartData1 = {
            labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
            datasets: [
                {
                    label: 'Tổng tiền theo năm',
                    backgroundColor: "#D9880F",
                    borderWidth: 1,
                    data: [15000000, 20000000, 18000000, 21000000, 13000000, 20000000, 17000000, 12000000, 16000000, 19000000, 14000000, 20000000]
                }
            ]
        };
        var myBarChart1 = new Chart(ctx1, {
            type: 'bar',
            data: barChartData1,
        });
        // Chọn năm và truyền
        $('#ddlYear').on('change', function () {
            var year = $(this).val();
            GetReportList(year);
        });

        // Set năm hiển thị ban đầu
        //var dt = new Date();
        //GetReportList(dt.getFullYear());
        GetReportList(2021);

        //// Đọc năm và trả về object
        function GetReportList(year) {
            $.ajax({
                url: "/Chart/GetAllDateUserMem?year=" + year,
                type: "POST",
                //contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (dataChart) {
                    var lsLabel = [];
                    var lsDataSource = [];

                    $.each(JSON.parse(dataChart), function (index, item) {
                        lsLabel.push(item.Thang);
                        lsDataSource.push(item.SoLuong);
                    });

                    var ctx = document.getElementById('chartProduct');
                    var dataT = {
                        labels: lsLabel,
                        datasets: [
                            {
                                label: 'Tổng sản phẩm theo năm',
                                backgroundColor: "#0b9663",
                                borderWidth: 1,
                                data: [15, 20, 18, 21, 13, 20, 17, 12, 16, 19, 14, 20]
                            },
                            {
                                label: "Tổng thành viên theo năm",
                                data: lsDataSource,
                                backgroundColor: "#CC975E",
                                borderWidth: 1

                                //fill: false,
                                //backgroundColor: ["rgba(54, 162, 235, 0.2)", "rgba(255, 99, 132, 0.2)", "rgba(255, 159, 64, 0.2)", "rgba(255, 205, 86, 0.2)", "rgba(75, 192, 192, 0.2)", "rgba(153, 102, 255, 0.2)", "rgba(201, 203, 207, 0.2)"],
                                //borderColor: ["rgb(54, 162, 235)", "rgb(255, 99, 132)", "rgb(255, 159, 64)", "rgb(255, 205, 86)", "rgb(75, 192, 192)", "rgb(153, 102, 255)", "rgb(201, 203, 207)"],
                            }
                        ]
                    };

                    var myBarChart = new Chart(ctx, {
                        type: 'bar',
                        data: dataT,
                    });
                }
            });
        }

            // Chọn năm và truyền
            //$('#ddlYear').on('change', function(){
            //    var year = $(this).val();
            //    GetReportList(year);
            //});

            //// Set năm hiển thị ban đầu
            ////var dt = new Date();
            ////GetReportList(dt.getFullYear());
            //GetReportList(2021);

            //// Đọc năm và trả về object
            //function GetReportList(year) {
            //    $.getJSON('Chart/GetAllDateUserMem/' + year, function (resp){
            //        RegisterChartProduct(resp);
            //    });
            //}

            //function RegisterChartProduct(listcount) {
            //    $("canvas#chartProduct").remove();
            //    $('#dvChart').html('<canvas id="chartProduct"></canvas>')
            //}
    </script>

}
